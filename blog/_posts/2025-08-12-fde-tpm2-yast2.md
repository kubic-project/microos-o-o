---
layout: post
title:  "YaST2 support for Full Disk Encryption with TPM2"
date:   2025-08-11 14:07:00 +0200
author: Thorsten Kukuk
---

## Intro

The openSUSE MicroOS installer (YaST2) supports since snapshot 20250809 Full Disk Encryption (FDE) secured by a TPM2 chip and [measured boot](https://en.opensuse.org/Portal:MicroOS/RemoteAttestation#Measured_boot) or a FIDO2 key.

Since quite some time the openSUSE project provides already images with Full Disk Encryption and TPM2 (e.g. [openSUSE-MicroOS.x86_64-kvm-and-xen-sdboot.qcow2](https://download.opensuse.org/tumbleweed/appliances/openSUSE-MicroOS.x86_64-kvm-and-xen-sdboot.qcow2) or [openSUSE-MicroOS.x86_64-kvm-and-xen-grub-bls.qcow2](https://download.opensuse.org/tumbleweed/appliances/openSUSE-MicroOS.x86_64-kvm-and-xen-grub-bls.qcow2) for virtualized environments and there is a [bog](https://microos.opensuse.org/blog/2024-09-03-quickstart-fde-yast2/) describing how to setup such a system with YaST2.

Now the next step is done: YaST2 supports setting up FDE+TPM2 for openSUSE MicroOS, so this feature can be enabled in an easy way during installation.

This requires a bootloader following the [Boot Loader Specification (BLS)](https://uapi-group.org/specifications/specs/boot_loader_specification/). Available are grub2-bls and systemd-boot. For openSUSE MicroOS we decided to make
systemd-boot the default bootloader.

## Hardware Requirement:
- UEFI Firmware
- TPM2 Chip or FIDO2 key which supports the hmac-secret extension
- 4GB Memory

## Installation of openSUSE MicroOS

### Boot installation media

* Follow the workflow until "Installation Settings"
* Installation Settings:
  * Partitioning: ![installation-settings](/assets/images/yast2-fde-tpm2/YaST2-MicroOS-FDE+TPM2-1.png)
  * Select "Guided Setup", keep the defaults until the “Partitioning Scheme” screen. ![suggested-partitioning](/assets/images/yast2-fde-tpm2/YaST2-MicroOS-FDE+TPM2-2.png)
  * "Enable Disk Encryption" and enter the password. The password will be the recovery key. ![partitioning-scheme](/assets/images/yast2-fde-tpm2/YaST2-MicroOS-FDE+TPM2-5.png)
  * Accept changes ![accept-changes](/assets/images/yast2-fde-tpm2/YaST2-MicroOS-FDE+TPM2-6.png)
* Finish Installation

### Finish FDE Setup

Boot the new system

## Re-enrollment
If the prediction system fails, a new policy must be created for the new measurements to replace the policy stored in the TPM2.

With the recovery PIN (the password for FDE):
```
  # sdbootutil --ask-pin update-predictions
```

## Next Steps

The next step will be to make FDE+TPM2 the default for MicroOS.

## Further Documentation

* [MicroOS FDE](https://en.opensuse.org/Portal:MicroOS/FDE)
* [Quickstart in Full Disk Encryption with TPM and YaST2](https://microos.opensuse.org/blog/2024-09-03-quickstart-fde-yast2/)
* [Systemd-boot and Full Disk Encryption with TPM and FIDO2](https://microos.opensuse.org/blog/2023-12-20-sdboot-fde/)
